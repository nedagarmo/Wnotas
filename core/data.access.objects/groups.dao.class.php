<?php/*		Clase de métodos de inserción, modificación, eliminación y consulta sobre la tabla carreras * * @author Nelson D. Garzón M.	*/@session_start();include_once(dirname(__FILE__) . '/../data.bases/connection.mysql.class.php');include_once(dirname(__FILE__) . '/audit.dao.class.php');class groups {    private $conn;	private $audit;        function groups()    {        $this->conn = new connection();		$this->audit = new audit();            }	function get_all_count_groups()    {        $record_set = $this->conn->db->Execute('SELECT COUNT(*) FROM grupo');        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_group_by_id($id)    {        $record_set = $this->conn->db->Execute('SELECT * FROM grupo WHERE id = ?', array($id));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }	    function get_all_groups($order, $index, $page)    {        $record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM grupo g INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id ORDER BY '.$order.' LIMIT '.$index.','.$page);        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_groups_by_user($order, $index, $page, $user)    {        $record_set = $this->conn->db->Execute(' SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM inscripcion_materia im INNER JOIN grupo g ON im.grupo = g.id INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id WHERE im.usuario = '.$user.' ORDER BY '.$order.' LIMIT '.$index.','.$page);        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_groups_list()    {        $record_set = $this->conn->db->Execute('SELECT id, nombre FROM grupo ORDER BY nombre ASC');        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_groups_list_by_csm($csm)    {        $record_set = $this->conn->db->Execute('SELECT id, nombre FROM grupo WHERE carrera_semestre_materia = ? ORDER BY nombre ASC', array($csm));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_groups_list_by_subject($subject, $user)    {        $record_set = $this->conn->db->Execute('SELECT g.id, g.nombre FROM grupo g INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id INNER JOIN inscripcion_materia im ON g.id = im.grupo WHERE csm.materia = ? AND im.usuario = ? ORDER BY g.nombre ASC', array($subject, $user));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_groups($name)    {		$record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM grupo g INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id WHERE nombre = ?', array($name));			        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }        function get_groups_search($name = "", $order, $index, $page)    {		if(!empty($name)){			$record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM grupo g INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id WHERE CONCAT(nombre," ",descripcion) LIKE ? ORDER BY '.$order.' LIMIT '.$index.','.$page, array("%".$name."%"));		}else{			$record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM grupo g INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id ORDER BY '.$order.' LIMIT '.$index.','.$page);		}        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }		function get_groups_by_user_search($name = "", $order, $index, $page, $user)    {		if(!empty($name)){			$record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM inscripcion_materia im INNER JOIN grupo g ON im.grupo = g.id INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id WHERE im.usuario = '.$user.' AND CONCAT(g.nombre," ",g.descripcion) LIKE ? ORDER BY '.$order.' LIMIT '.$index.','.$page, array("%".$name."%"));		}else{			$record_set = $this->conn->db->Execute('SELECT g.*, csm.carrera, csm.semestre, csm.materia FROM inscripcion_materia im INNER JOIN grupo g ON im.grupo = g.id INNER JOIN carrera_semestre_materia csm ON g.carrera_semestre_materia = csm.id WHERE im.usuario = '.$user.' ORDER BY '.$order.' LIMIT '.$index.','.$page);		}        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }       function insert_groups($name, $description, $start, $end, $csm)    {		$this->audit->register_audit(1, 'INSERT INTO grupo(nombre, descripcion, inicio, fin, carrera_semestre_materia) VALUES(?,?,?,?,?) ', $_SESSION['id']);        return $this->conn->db->Execute('INSERT INTO grupo(nombre, descripcion, inicio, fin, carrera_semestre_materia) VALUES(?,?,?,?,?) ', 			   array($name, $description, $start, $end, $csm));    }		function update_groups($id, $name, $description, $start, $end, $csm)    {		$this->audit->register_audit(2, 'UPDATE grupo SET nombre = ?, descripcion = ?, inicio = ?, fin = ?, carrera_semestre_materia = ? WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('UPDATE grupo SET nombre = ?, descripcion = ?, inicio = ?, fin = ?, carrera_semestre_materia = ? WHERE id = ? ', 			   array($name, $description, $start, $end, $csm, $id));    }        function delete_groups($id)    {		$this->audit->register_audit(3, 'DELETE FROM grupo WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('DELETE FROM grupo WHERE id = ?', array($id));    }}	?>
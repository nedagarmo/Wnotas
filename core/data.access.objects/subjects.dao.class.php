<?php/*		Clase de métodos de inserción, modificación, eliminación y consulta sobre la tabla materias * * @author Nelson D. Garzón M.	*/@session_start();include_once(dirname(__FILE__) . '/../data.bases/connection.mysql.class.php');include_once(dirname(__FILE__) . '/audit.dao.class.php');class subjects {    private $conn;	private $audit;        function subjects()    {        $this->conn = new connection();		$this->audit = new audit();            }	function get_all_count_subjects()    {        $record_set = $this->conn->db->Execute('SELECT COUNT(*) FROM materia');        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }	    function get_all_subjects($order, $index, $page)    {        $record_set = $this->conn->db->Execute('SELECT * FROM materia ORDER BY '.$order.' LIMIT '.$index.','.$page);        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_subjects_list()    {        $record_set = $this->conn->db->Execute('SELECT id, nombre FROM materia ORDER BY nombre ASC ');        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_subjects_list_by_semester($career, $semester)    {        $record_set = $this->conn->db->Execute('SELECT DISTINCT m.id, m.nombre FROM carrera_semestre_materia csm INNER JOIN materia m ON csm.materia = m.id WHERE csm.semestre = ? AND csm.carrera = ? ORDER BY m.nombre ASC', array($semester, $career));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_subjects_list_by_user($user)    {        $record_set = $this->conn->db->Execute(' SELECT DISTINCT m.id, m.nombre FROM carrera_semestre_materia csm INNER JOIN materia m ON csm.materia = m.id INNER JOIN usuario_carrera uc ON csm.carrera = uc.carrera WHERE uc.usuario = ? ORDER BY m.nombre ASC ', array($user));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_subjects_list_by_session($user)    {        $record_set = $this->conn->db->Execute(' SELECT ma.id, ma.nombre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id INNER JOIN materia ma ON csm.materia = ma.id WHERE im.usuario = ? ORDER BY ma.nombre ASC ', array($user));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_subject($id)    {		$record_set = $this->conn->db->Execute('SELECT * FROM materia WHERE nombre = ?', array($id));			        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }		function get_subject_by_group($group)    {		$record_set = $this->conn->db->Execute(' SELECT DISTINCT m.* FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id INNER JOIN materia m ON csm.materia = m.id INNER JOIN grupo g ON im.grupo = g.id WHERE g.nombre = ? ', array($group));			        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }        function get_subject_search($name = "", $order, $index, $page)    {		if(!empty($name)){			$record_set = $this->conn->db->Execute('SELECT * FROM materia WHERE CONCAT(nombre," ",descripcion) LIKE ? ORDER BY '.$order.' LIMIT '.$index.','.$page, array("%".$name."%"));		}else{			$record_set = $this->conn->db->Execute('SELECT * FROM materia ORDER BY '.$order.' LIMIT '.$index.','.$page);		}        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }       function insert_subject($name, $description)    {		$this->audit->register_audit(1, 'INSERT INTO materia(nombre, descripcion) VALUES(?,?)', $_SESSION['id']);        return $this->conn->db->Execute('INSERT INTO materia(nombre, descripcion) VALUES(?,?) ', 			   array($name, $description));    }		function update_subject($id, $name, $description)    {		$this->audit->register_audit(2, 'UPDATE materia SET nombre = ?, descripcion = ? WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('UPDATE materia SET nombre = ?, descripcion = ? WHERE id = ? ', 			   array($name, $description, $id));    }        function delete_subject($id)    {		$this->audit->register_audit(3, 'DELETE FROM materia WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('DELETE FROM materia WHERE id = ?', array($id));    }}	?>
<?php/** * Clase de métodos de inserción, modificación, eliminación y consulta sobre la tabla usuarios * * @author Nelson D. Garzón M. */@session_start();include_once(dirname(__FILE__) . '/../data.bases/connection.mysql.class.php');include_once(dirname(__FILE__) . '/audit.dao.class.php');class registrations {    private $conn;	private $audit;        function registrations()    {        $this->conn = new connection();		$this->audit = new audit();		    }    	function get_all_count_registrations()    {        $record_set = $this->conn->db->Execute('SELECT COUNT(*) FROM inscripcion_materia');        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }	    function get_all_registrations($order, $index, $page)    {        $record_set = $this->conn->db->Execute('SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id ORDER BY '.$order.' LIMIT '.$index.','.$page);        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_all_registrations_by_student($user, $order, $index, $page)    {        $record_set = $this->conn->db->Execute('SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id WHERE im.usuario = ? ORDER BY '.$order.' LIMIT '.$index.','.$page, array($user));        if($record_set != false)        {            return $record_set;        }  else {            return null;        }    }		function get_registration($user, $group, $association)    {		$record_set = $this->conn->db->Execute('SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id WHERE usuario = ? and grupo = ? and carrera_semestre_materia = ? ', array($user, $group, $association));			        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }        function get_registration_search($user = "", $group = "", $order, $index, $page)    {		if(!empty($user) && !empty($group)){			$record_set = $this->conn->db->Execute("SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id INNER JOIN grupo g ON im.grupo = g.id INNER JOIN usuario u ON im.usuario = u.id WHERE CONCAT(u.nombres,' ',u.apellidos) LIKE ? AND CONCAT(g.nombre,' ',g.descripcion) LIKE ? ORDER BY ".$order.' LIMIT '.$index.','.$page, array("%".$user."%", "%".$group."%"));		}else{			if(!empty($user) && empty($group)){				$record_set = $this->conn->db->Execute("SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id INNER JOIN grupo g ON im.grupo = g.id INNER JOIN usuario u ON im.usuario = u.id WHERE CONCAT(u.nombres,' ',u.apellidos) LIKE ? ORDER BY ".$order.' LIMIT '.$index.','.$page, array("%".$user."%"));			}else if(empty($user) && !empty($group)){				$record_set = $this->conn->db->Execute("SELECT im.*, csm.carrera, csm.materia, csm.semestre FROM inscripcion_materia im INNER JOIN carrera_semestre_materia csm ON im.carrera_semestre_materia = csm.id INNER JOIN grupo g ON im.grupo = g.id INNER JOIN usuario u ON im.usuario = u.id WHERE CONCAT(g.nombre,' ',g.descripcion) LIKE ? ORDER BY ".$order.' LIMIT '.$index.','.$page, array("%".$group."%"));			}		}        if($record_set != false)        {            return $record_set;        }  else {            return null;        }     }        function insert_registration($group, $association, $user)    {		$this->audit->register_audit(1, 'INSERT INTO inscripcion_materia(grupo, carrera_semestre_materia, usuario) VALUES(?,?,?)', $_SESSION['id']);        return $this->conn->db->Execute('INSERT INTO inscripcion_materia(grupo, carrera_semestre_materia, usuario) VALUES(?,?,?) ', 			   array($group, $association, $user));    }		function update_registration($id, $group, $association, $user)    {		$this->audit->register_audit(2, 'UPDATE inscripcion_materia SET grupo = ?, carrera_semestre_materia = ?, usuario = ? WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('UPDATE inscripcion_materia SET grupo = ?, carrera_semestre_materia = ?, usuario = ? WHERE id = ? ', 			   array($group, $association, $user, $id));    }        function delete_registration($id)    {		$this->audit->register_audit(3, 'DELETE FROM inscripcion_materia WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('DELETE FROM inscripcion_materia WHERE id = ?', array($id));    }}?>
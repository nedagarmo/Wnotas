<?php/** * Clase de métodos de inserción, modificación, eliminación y consulta sobre la tabla usuarios * * @author Nelson D. Garzón M. */@session_start();include_once(dirname(__FILE__) . '/../data.bases/connection.mysql.class.php');include_once(dirname(__FILE__) . '/audit.dao.class.php');class users_careers {    private $conn;    private $audit;    function users_careers() {        $this->conn = new connection();        $this->audit = new audit();    }    function get_all_count_users_careers() {        $record_set = $this->conn->db->Execute('SELECT COUNT(*) FROM usuario_carrera');        if ($record_set != false) {            return $record_set;        } else {            return null;        }    }    function get_all_users_careers($order, $index, $page) {        $record_set = $this->conn->db->Execute('SELECT * FROM usuario_carrera ORDER BY ' . $order . ' LIMIT ' . $index . ',' . $page);        if ($record_set != false) {            return $record_set;        } else {            return null;        }    }    function get_users_career($user, $career) {        $record_set = $this->conn->db->Execute('SELECT * FROM usuario_carrera WHERE usuario = ? and carrera = ? ', array($user, $career));        if ($record_set != false) {            return $record_set;        } else {            return null;        }    }        function get_users_count_career($user, $career) {        $record_set = $this->conn->db->Execute('SELECT COUNT(*) FROM usuario_carrera WHERE usuario = ? and carrera = ? ', array($user, $career));        if ($record_set != false) {            return $record_set;        } else {            return null;        }    }    function get_users_careers_search($user = "", $career = "", $order, $index, $page) {        if (!empty($user) && !empty($career)) {            $record_set = $this->conn->db->Execute("SELECT uc.* FROM usuario_carrera uc INNER JOIN carrera c ON uc.carrera = c.id INNER JOIN usuario u ON uc.usuario = u.id WHERE CONCAT(c.nombre,' ',c.descripcion) LIKE ? AND CONCAT(u.nombres,' ',u.apellidos) LIKE ? ORDER BY uc." . $order . ' LIMIT ' . $index . ',' . $page, array("%" . $career . "%", "%" . $user . "%"));        } else {            if (!empty($user) && empty($career)) {                $record_set = $this->conn->db->Execute("SELECT uc.* FROM usuario_carrera uc INNER JOIN usuario u ON uc.usuario = u.id WHERE CONCAT(u.nombres,' ',u.apellidos) LIKE ? ORDER BY uc." . $order . ' LIMIT ' . $index . ',' . $page, array("%" . $user . "%"));            } else if (empty($user) && !empty($career)) {                $record_set = $this->conn->db->Execute("SELECT uc.* FROM usuario_carrera uc INNER JOIN carrera c ON uc.carrera = c.id WHERE CONCAT(c.nombre,' ',c.descripcion) LIKE ? ORDER BY uc." . $order . ' LIMIT ' . $index . ',' . $page, array("%" . $career . "%"));            }        }        if ($record_set != false) {            return $record_set;        } else {            return null;        }    }    function insert_users_career($usuario, $carrera) {        $this->audit->register_audit(1, 'INSERT INTO usuario_carrera(usuario, carrera) VALUES(?,?)', $_SESSION['id']);        return $this->conn->db->Execute('INSERT INTO usuario_carrera(usuario, carrera) VALUES(?,?) ', array($usuario, $carrera));    }    function update_users_career($id, $usuario, $carrera) {        $this->audit->register_audit(2, 'UPDATE usuario_carrera SET usuario = ?, carrera = ? WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('UPDATE usuario_carrera SET usuario = ?, carrera = ? WHERE id = ? ', array($usuario, $carrera, $id));    }    function delete_users_career($id) {        $this->audit->register_audit(3, 'DELETE FROM usuario_carrera WHERE id = ?', $_SESSION['id']);        return $this->conn->db->Execute('DELETE FROM usuario_carrera WHERE id = ?', array($id));    }}?>